<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>DNA | Darshan Baral</title>
    <meta content="DNA" name="description">
    <meta content="Darshan Baral" name="author">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" rel="stylesheet">
    <script crossorigin="anonymous" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script crossorigin="anonymous" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script crossorigin="anonymous" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

    <script>
        function myFunction() {
            let i;
            let error;
            let error_num = 0;
            let flag = 0;
            let dna = document.getElementById("dna_input").value;
            if (dna.length === 0) {
                document.getElementById('output_area').style.display = 'none';
            } else {
                document.getElementById('output_area').style.display = 'block';
            }
            if (document.getElementById("No_of_bases").checked === false &&
                document.getElementById("GC_Ratio").checked === false &&
                document.getElementById("N_and_invalid_bases").checked === false &&
                document.getElementById("O_Sequence").checked === false &&
                document.getElementById("C_Sequence").checked === false &&
                document.getElementById("Rev_Sequence").checked === false &&
                document.getElementById("Rev_C_Sequence").checked === false) {
                flag = 20; //set a flag if none of the output options have been checked
            }
            dna = dna.replace(/ /g, ''); //Remove space in input
            dna = dna.replace(/\t/g, ''); //Replace tab in input
            dna = dna.replace(/\n/g, ''); //Replace line break in input
            let nt_ = dna.split(""); //Split the sequence into array with individual letters
            let nucleotides_array = [];

            // Capitalize all bases, replace invalid bases with N, and store in the array 'nt'
            for (i = 0; i < nt_.length; i++) {
                if (nt_[i] === "A" || nt_[i] === "a") {
                    nucleotides_array[i] = "A";
                } else if (nt_[i] === "T" || nt_[i] === "t") {
                    nucleotides_array[i] = "T";
                } else if (nt_[i] === "C" || nt_[i] === "c") {
                    nucleotides_array[i] = "C";
                } else if (nt_[i] === "G" || nt_[i] === "g") {
                    nucleotides_array[i] = "G";
                } else if (nt_[i] === "N" || nt_[i] === "n") {
                    nucleotides_array[i] = "N";
                } else {
                    error_num += 1; //Count the number of invalid bases
                    nucleotides_array[i] = "N";
                }
            }

            let gc_bases = 0;
            let atgc_bases;
            let n_base = 0;
            for (i = 0; i < nucleotides_array.length; i++) {
                if (nucleotides_array[i] === "C" || nucleotides_array[i] === "G") {
                    gc_bases = gc_bases + 1; //Count the number of G and C bases
                }
                if (nucleotides_array[i] === "N") {
                    n_base = n_base + 1; //Count the number of N bases (including invalid bases in the input sequence)
                }
            }

            let dna_sequence_length;
            if (document.getElementById("No_of_bases").checked === true) {
                dna_sequence_length = nucleotides_array.length;
            }

            atgc_bases = nucleotides_array.length - n_base;

            let GC_ratio = 100 * gc_bases / atgc_bases;
            let gc_ratio_number = Math.round(GC_ratio * 100) / 100; //Round GC ratio to two digits

            function complement(input_dna_array) {
                let complement_array = [];
                for (let i = 0; i < input_dna_array.length; i++) {
                    if (input_dna_array[i] === "A") {
                        complement_array[i] = "T";
                    } else if (input_dna_array[i] === "T") {
                        complement_array[i] = "A";
                    } else if (input_dna_array[i] === "C") {
                        complement_array[i] = "G";
                    } else if (input_dna_array[i] === "G") {
                        complement_array[i] = "C";
                    } else {
                        complement_array[i] = "N";
                    }
                }
                return complement_array;
            }

            function join(dna_array) {
                let combined_sequence = "";
                for (let i = 0; i < dna_array.length; i++) {
                    if (i % 3 === 0 && i > 0) { //add a space after groups of three bases for convenience
                        combined_sequence = `${combined_sequence} ${dna_array[i]}`;
                    } else {
                        combined_sequence = `${combined_sequence}${dna_array[i]}`;
                    }
                }
                return combined_sequence;
            }

            function reverse(input_dna_array) {
                let reverse_array = [];
                for (let i = 0; i < input_dna_array.length; i++) {
                    reverse_array[i] = input_dna_array[(input_dna_array.length - 1) - i];
                }
                return reverse_array;
            }

            let original_sequence = "";
            let complement_array = [];
            let complement_sequence = "";
            let reverse_array = [];
            let reverse_sequence = "";
            let reverse_complement_array = [];
            let reverse_complement_sequence = "";

            if (document.getElementById("O_Sequence").checked === true) {
                original_sequence = join(nucleotides_array);
            }

            if (document.getElementById("C_Sequence").checked === true) {
                complement_array = complement(nucleotides_array);
                complement_sequence = join(complement_array);
            }

            if (document.getElementById("Rev_Sequence").checked === true) {
                reverse_array = reverse(nucleotides_array);
                reverse_sequence = join(reverse_array);
            }

            if (document.getElementById("Rev_C_Sequence").checked === true) {
                let reverse_nucleotide_array = reverse(nucleotides_array);
                reverse_complement_array = complement(reverse_nucleotide_array);
                reverse_complement_sequence = join(reverse_complement_array);
            }

            if (error_num === 0) {
                error = "";
            } else if (error_num === 1) {
                error = `${error_num} invalid character (other than A, C, T, G, and N) was found and replaced with 'N'`;
            } else {
                error = `${error_num} invalid characters (other than A, C, T, G, and N) were found and replaced with 'N'`;
            }

            let gc_ratio_percent = "";
            if (document.getElementById("GC_Ratio").checked === true) {
                gc_ratio_percent = `${gc_ratio_number}%`;
            }

            if (document.getElementById("No_of_bases").checked === true && atgc_bases === 0 && dna.length > 0) {
                document.getElementById("nb").innerHTML = "<h5>Number of Bases</h5><code>Input sequence is not a valid sequence</code>";
            } else if (document.getElementById("No_of_bases").checked === true && dna.length > 0) {
                document.getElementById("nb").innerHTML = `<h5>Number of Bases</h5><code style='color: black;'>${dna_sequence_length}</code>`;
            } else {
                document.getElementById("nb").innerHTML = "";
            }

            if (document.getElementById("GC_Ratio").checked === true && atgc_bases === 0 && dna.length > 0) {
                document.getElementById("GC").innerHTML = "<h5>GC Ratio, (G + C)/(A + C + T + G)</h5><code>Input sequence is not a valid sequence</code>";
            } else if (document.getElementById("GC_Ratio").checked === true && dna.length > 0) {
                document.getElementById("GC").innerHTML = `<h5>GC Ratio, (G + C)/(A + C + T + G)</h5><code style='color: black;'>${gc_ratio_percent}</code>`;
            } else {
                document.getElementById("GC").innerHTML = "";
            }

            if (document.getElementById("N_and_invalid_bases").checked === true && atgc_bases === 0 && dna.length > 0) {
                document.getElementById("N_base").innerHTML = "<h5>Number of 'N' and invalid bases</h5><code>ALL OF IT!!!</code>";
            } else if (document.getElementById("N_and_invalid_bases").checked === true && dna.length > 0) {
                document.getElementById("N_base").innerHTML = `<h5>Number of 'N' and invalid bases</h5><code style='color: black;'>${n_base}</code><br><span style='font-size: 14px;' class='text-danger'>${error}</span>`;
            } else {
                document.getElementById("N_base").innerHTML = "";
            }

            if (document.getElementById("O_Sequence").checked === true && atgc_bases === 0 && dna.length > 0) {
                document.getElementById("dna").innerHTML = "<h5>Original Sequence</h5><code>Input sequence is not a valid sequence</code>";
            } else if (document.getElementById("O_Sequence").checked === true && dna.length > 0) {
                document.getElementById("dna").innerHTML = `<h5>Original Sequence</h5><code style='color: black;'>${original_sequence}<code style='color: black;'>`;
            } else {
                document.getElementById("dna").innerHTML = "";
            }

            if (document.getElementById("C_Sequence").checked === true && atgc_bases === 0 && dna.length > 0) {
                document.getElementById("cp").innerHTML = "<h5>Complement Sequence</h5><code>Input sequence is not a valid sequence</code>";
            } else if (document.getElementById("C_Sequence").checked === true && dna.length > 0) {
                document.getElementById("cp").innerHTML = `<h5>Complement Sequence</h5><code style='color: black;'>${complement_sequence}</code>`;
            } else {
                document.getElementById("cp").innerHTML = "";
            }

            if (document.getElementById("Rev_Sequence").checked === true && atgc_bases === 0 && dna.length > 0) {
                document.getElementById("rv").innerHTML = "<h5>Reverse Sequence</h5><code>Input sequence is not a valid sequence</code>";
            } else if (document.getElementById("Rev_Sequence").checked === true && dna.length > 0) {
                document.getElementById("rv").innerHTML = `<h5>Reverse Sequence</h5><code style='color: black;'>${reverse_sequence}</code>`;
            } else {
                document.getElementById("rv").innerHTML = "";
            }

            if (document.getElementById("Rev_C_Sequence").checked === true && atgc_bases === 0 && dna.length > 0) {
                document.getElementById("rv_cp").innerHTML = "<h5>Reverse Complement Sequence</h5><code>Input sequence is not a valid sequence</code>";
            } else if (document.getElementById("Rev_C_Sequence").checked === true && dna.length > 0) {
                document.getElementById("rv_cp").innerHTML = `<h5>Reverse Complement Sequence</h5><code style='color: black;'>${reverse_complement_sequence}</code>`;
            } else {
                document.getElementById("rv_cp").innerHTML = "";
            }

            if (flag === 20) {
                document.getElementById("N_base").innerHTML = "<h5 class='text-danger'>Select at least one option</h5>";
            }
        }
    </script>

</head>

<body>
<div class="container">
    <h1 class="text-center">DNA Sequence Information</h1>
    <p class="text-center" style="font-size: 14px;">Made by <a href="https://darshanbaral.com">Darshan Baral</a>.</p>

    <div class="row">
        <div class="col-md-6 border-top" id="input_form">
            <h4>Select Options</h4>
            <form action="" id="chkbx">
                <label><input checked id="No_of_bases" type="checkbox"> Number of bases</label>
                <br>
                <label><input checked id="GC_Ratio" type="checkbox"> GC Ratio</label>
                <br>
                <label><input checked id="N_and_invalid_bases" type="checkbox"> N bases (including invalid
                    bases)</label>
                <br>
                <label><input checked id="O_Sequence" type="checkbox"> Original Sequence</label>
                <br>
                <label><input id="C_Sequence" type="checkbox"> Complement Sequence</label>
                <br>
                <label><input id="Rev_Sequence" type="checkbox"> Reverse Sequence</label>
                <br>
                <label><input id="Rev_C_Sequence" type="checkbox"> Reverse Complement Sequence</label>
                <br>
            </form>

            <button class="btn btn-primary btn-lg btn-block mt-2 mb-2" id="button" onclick="myFunction()">Generate
                Output
            </button>

            <h4>Enter DNA sequence</h4>
            <textarea class="form-control rounded-2 mb-2" id="dna_input"
                      placeholder="Input DNA sequence here. White spaces and line breaks in the input will be ignored. Input is not case sensitive."
                      rows="5"></textarea>
        </div>

        <div class="col-md-6 border-top" id="output_area" style="display:none">
            <p id="nb"></p>
            <p id="GC"></p>
            <p id="N_base"></p>
            <p id="dna"></p>
            <p id="cp"></p>
            <p id="rv"></p>
            <p id="rv_cp"></p>
        </div>

        <br>
    </div>
</div>
</body>
</html>
